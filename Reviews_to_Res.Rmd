---
title: "Reviews_to_Res"
author: "Wenjun Zeng"
date: "4/29/2017"
output: html_document
---

```{r}
library(readr)
library(stringr)
library(tidyr)
require(RJSONIO)
library(dplyr)
library(plyr)
require(doMC)
registerDoMC(cores=4)
library(zoo)
library(rARPACK)
```
```{r}
reviews = read_csv("yelp_academic_dataset_review_test.csv")
bus = read_csv("yelp_academic_dataset_business_test.csv")
```

```{r}
reviews = reviews %>% 
  mutate(stars = 3) %>% 
  select(user_id, business_id, stars)
reviews_by_bus = reviews %>% 
  spread(key = business_id, value = stars) %>% 
  select(-user_id)
bus_star_mean = colMeans(reviews_by_bus, na.rm=TRUE) %>% 
  data.frame()

match = function(bid){
  row_i = which(bid == rownames(bus_star_mean))
  star = bus_star_mean[row_i,]
  star
}
stars = sapply(bus$business_id, match)
bus_output = cbind(bus, stars)
```